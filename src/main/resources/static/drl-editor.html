<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DRL 规则编辑器</title>
  <script src="/lib/js/vue.js"></script>
  <script src="/lib/js/tw.js"></script>
  <!-- Import style -->
  <link rel="stylesheet" href="//unpkg.com/element-plus/dist/index.css" />
  <script src="//unpkg.com/element-plus"></script>
  <!-- <style type="text/tailwindcss">
		@layer theme, components, utilities;
		@import "tailwindcss/theme.css" layer(theme) important;
		@import "tailwindcss/utilities.css" layer(utilities) important;
  </style> -->
  <style>

    /* 滚动条样式 - 浅色 */
    #codePreview::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    #codePreview::-webkit-scrollbar-track {
      background: #f1f5f9;
    }
    #codePreview::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 4px;
    }
    #codePreview::-webkit-scrollbar-thumb:hover {
      background: #94a3b8;
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="bg-gradient-to-br from-slate-50 via-blue-50 to-slate-50 min-h-screen p-4">
      <div class="max-w-7xl mx-auto space-y-4">
        <!-- 标题 -->
        <div class="bg-white/90 backdrop-blur-sm rounded-lg shadow-sm p-4 border border-slate-200">
          <div class="flex flex-col md:flex-row md:items-center md:justify-between space-y-3 md:space-y-0">
            <div>
              <h1 class="text-2xl font-bold bg-gradient-to-r from-sky-600 to-indigo-600 bg-clip-text text-transparent">DRL 规则编辑器</h1>
              <p class="text-sm text-gray-600">可视化生成 Drools 规则文件</p>
            </div>
             <div class="flex flex-wrap gap-2">
               <el-button type="warning" @click="loadSample" size="small">
                 加载示例
               </el-button>
               <el-button type="success" @click="downloadDRL" size="small">
                 下载 DRL 文件
               </el-button>
               <el-button
                 :type="copyButtonText === '已复制！' ? 'success' : 'primary'"
                 @click="copyCode"
                 size="small">
                 {{ copyButtonText }}
               </el-button>
               <el-button type="info" @click="goHome" size="small">
                 返回首页
               </el-button>
             </div>
          </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
          <!-- 左侧：规则配置表单 -->
          <div class="space-y-4">
            <!-- 全局配置 -->
            <div class="bg-white/90 backdrop-blur-sm rounded-lg shadow-sm p-4 border border-slate-200">
              <h2 class="text-lg font-semibold text-gray-700 mb-3">全局配置</h2>
              <div class="space-y-3">
                 <div>
                   <label class="block text-sm font-medium text-gray-700 mb-1">包名 (package)</label>
                   <el-input v-model="config.package" placeholder="com.example.rules"></el-input>
                 </div>
                 <div>
                   <label class="block text-sm font-medium text-gray-700 mb-1">Unit 名称 (可选)</label>
                   <el-input v-model="config.unit" placeholder="例如: PersonRules"></el-input>
                 </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">导入语句 (每行一个)</label>
                  <el-input
                    v-model="config.imports"
                    type="textarea"
                    :rows="4"
                    placeholder="例如:&#10;import com.example.droolsdemo.model.Person;&#10;import com.example.droolsdemo.util.RuleUtils;&#10;import java.util.List;"
                    style="font-family: monospace;">
                  </el-input>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">全局变量 (每行一个)</label>
                  <el-input
                    v-model="config.globals"
                    type="textarea"
                    :rows="3"
                    placeholder="例如:&#10;global org.slf4j.Logger logger;&#10;global java.util.Map dataMap;"
                    style="font-family: monospace;">
                  </el-input>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">声明类型 (declare, 可选)</label>
                  <el-input
                    v-model="config.declarations"
                    type="textarea"
                    :rows="3"
                    placeholder="例如:&#10;declare Animal&#10;    name: String&#10;    age: int&#10;end"
                    style="font-family: monospace;">
                  </el-input>
                </div>
              </div>
            </div>

            <!-- 规则列表 -->
            <div class="bg-white/90 backdrop-blur-sm rounded-lg shadow-sm p-4 border border-slate-200">
               <div class="flex justify-between items-center mb-3">
                 <h2 class="text-lg font-semibold text-gray-700">规则列表</h2>
                 <el-button type="primary" size="small" @click="addRule">
                   + 添加规则
                 </el-button>
               </div>
              <div class="space-y-3">
                <div v-for="(rule, index) in rules" :key="index" class="border border-slate-200 rounded-lg p-4 bg-gradient-to-br from-white to-slate-50 shadow-sm hover:shadow-md transition-all">
                  <div class="flex justify-between items-center mb-2">
                    <el-input v-model="rule.name" placeholder="规则名称" size="small" style="max-width: 300px;"></el-input>
                    <el-button type="danger" size="small" @click="removeRule(index)" circle>
                      ×
                    </el-button>
                  </div>
                  <div class="space-y-2">
                    <div class="grid grid-cols-3 gap-2 text-xs">
                      <el-checkbox v-model="rule.enabled" size="small">启用</el-checkbox>
                      <el-checkbox v-model="rule.noLoop" size="small">No-Loop</el-checkbox>
                      <el-checkbox v-model="rule.lockOnActive" size="small">Lock-Active</el-checkbox>
                    </div>
                    <div>
                      <label class="block text-xs font-medium text-gray-700 mb-1">优先级 (salience)</label>
                      <el-input-number v-model="rule.salience" :min="0" :max="999" size="small"></el-input-number>
                    </div>
                    <div>
                      <label class="block text-xs font-medium text-gray-700 mb-1">When 条件</label>
                      <el-input
                        v-model="rule.when"
                        type="textarea"
                        :rows="2"
                        placeholder="例如: $p: Person($age: age >= 18)"
                        size="small"
                        style="font-family: monospace;">
                      </el-input>
                    </div>
                    <div>
                      <label class="block text-xs font-medium text-gray-700 mb-1">Then 动作</label>
                      <el-input
                        v-model="rule.then"
                        type="textarea"
                        :rows="3"
                        placeholder="例如: $p.setAdult(true); update($p);"
                        size="small"
                        style="font-family: monospace;">
                      </el-input>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- 右侧：代码预览和帮助 -->
          <div class="space-y-4">
            <div class="bg-white/90 backdrop-blur-sm rounded-lg shadow-sm p-4 border border-slate-200">
              <h2 class="text-lg font-semibold text-gray-700 mb-3">DRL 代码预览</h2>
              <pre id="codePreview" class="bg-gradient-to-br from-slate-50 to-slate-100 border border-slate-300 text-slate-800 p-4 rounded overflow-x-auto text-sm font-mono min-h-[400px] max-h-[600px] shadow-inner">{{ generateDRL() }}</pre>
            </div>

            <!-- 帮助说明 -->
            <div class="bg-blue-50 border-l-4 border-blue-500 rounded-lg p-4">
              <div class="flex items-start">
                <svg class="w-5 h-5 text-blue-600 mt-0.5 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                </svg>
                <div class="text-sm text-blue-800">
                  <p class="font-semibold mb-1">使用提示：</p>
                  <ul class="list-disc list-inside space-y-1 text-xs">
                    <li><strong>包名 (Package):</strong> 定义规则所属的包</li>
                    <li><strong>Unit 名称:</strong> 单元名称，用于规则组织</li>
                    <li><strong>导入 (Import):</strong> 导入需要的Java类</li>
                    <li><strong>全局变量 (Global):</strong> 定义全局对象，如logger</li>
                    <li><strong>Salience:</strong> 规则优先级，数值越大越先执行</li>
                    <li><strong>No-Loop:</strong> 防止规则循环触发</li>
                    <li><strong>When:</strong> 规则条件（LHS - Left Hand Side）</li>
                    <li><strong>Then:</strong> 规则动作（RHS - Right Hand Side）</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Vue 应用脚本 -->
  <script src="/lib/js/drl-editor.js"></script>
</body>
</html>
